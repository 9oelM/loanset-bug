=== LoanSet: Single Signature Flow (Matching Integration Test) ===

Loan Broker: r9BABspCLg4Ma6WqiZy6USTdu68qzz4noj
Borrower: rL8VRjZriieaoNmLCMvet45VPMT8nrcHP4

Step 1: Creating and autofilling LoanSet transaction...
For LoanSet transaction the auto calculated Fee accounts for total number of signers the counterparty has to avoid transaction failure.
✓ Transaction autofilled

Step 2: Loan broker signs the transaction...
✓ Loan broker signed
  tx_blob length: 454 characters

Step 3: Verifying loan broker signature...
✓ Signature valid: true

Step 4: Borrower signs with CounterpartySignature...
✓ Borrower counterparty signature created
  Structure: {
  HasMainSignature: true,
  HasCounterpartySignature: true,
  CounterpartyFields: [ 'SigningPubKey', 'TxnSignature' ]
}
  Hash: 06A6AE848F6EBAA312C077A36FF83D56B7EF1C06896CCC4074C740C1D74766A4
  tx_blob length: 662

  Full transaction:
{
  "TransactionType": "LoanSet",
  "Flags": 0,
  "Sequence": 3652011,
  "LastLedgerSequence": 3653781,
  "PaymentTotal": 1,
  "LoanBrokerID": "C275AED0288B541436A1B6201C2E46BC21701DEACC20DD12FB39860970D9F6FD",
  "Fee": "2",
  "SigningPubKey": "ED877561249843A3AFE483CA31ACC5FE82B3E6AAA82826C4801DF9D084068196A9",
  "TxnSignature": "A3947717FF8CCC75F7CBB4F043EE9EB8B5FE7053E61CAAF025971C6816BD36A21D74F8AF8925ECEA6D86A276DC912DF7FD5165D3C09D39B919E0FFABB1625B01",
  "Account": "r9BABspCLg4Ma6WqiZy6USTdu68qzz4noj",
  "Counterparty": "rL8VRjZriieaoNmLCMvet45VPMT8nrcHP4",
  "PrincipalRequested": "5000",
  "CounterpartySignature": {
    "SigningPubKey": "ED1096BF29FB92CB0F25F900455567F31999F295858D9619E840F44513AC072F6F",
    "TxnSignature": "296B0EF1247688B5DBEE7A43DA0CC2FD0766B97F6B6428D20D428A01D597DD0B214E96333EF466B0E9CB8ADE38196A2794DD5247F4AABAB77399C5862556E502"
  }
}

Step 5: Submitting transaction...

❌ Error submitting transaction:

Full error object:
{
  "name": "RippledError",
  "data": {
    "api_version": 2,
    "error": "invalidTransaction",
    "error_exception": "fails local checks: Invalid signature.",
    "id": 5,
    "request": {
      "api_version": 2,
      "command": "submit",
      "fail_hard": false,
      "id": 5,
      "tx_blob": "1200502200000000240037B9AB201B0037C095203C000000015025C275AED0288B541436A1B6201C2E46BC21701DEACC20DD12FB39860970D9F6FD6840000000000000027321ED877561249843A3AFE483CA31ACC5FE82B3E6AAA82826C4801DF9D084068196A97440A3947717FF8CCC75F7CBB4F043EE9EB8B5FE7053E61CAAF025971C6816BD36A21D74F8AF8925ECEA6D86A276DC912DF7FD5165D3C09D39B919E0FFABB1625B01811459D2632280FD98B49210453C3B1A2806687FA54E801A14D904D65DF80425AE39A43CA56C68BD211D7990E99E4563918244F40000FFFFFFF1E0257321ED1096BF29FB92CB0F25F900455567F31999F295858D9619E840F44513AC072F6F7440296B0EF1247688B5DBEE7A43DA0CC2FD0766B97F6B6428D20D428A01D597DD0B214E96333EF466B0E9CB8ADE38196A2794DD5247F4AABAB77399C5862556E502E1"
    },
    "status": "error",
    "type": "response"
  }
}

Error message: fails local checks: Invalid signature.

Error data:
{
  "api_version": 2,
  "error": "invalidTransaction",
  "error_exception": "fails local checks: Invalid signature.",
  "id": 5,
  "request": {
    "api_version": 2,
    "command": "submit",
    "fail_hard": false,
    "id": 5,
    "tx_blob": "1200502200000000240037B9AB201B0037C095203C000000015025C275AED0288B541436A1B6201C2E46BC21701DEACC20DD12FB39860970D9F6FD6840000000000000027321ED877561249843A3AFE483CA31ACC5FE82B3E6AAA82826C4801DF9D084068196A97440A3947717FF8CCC75F7CBB4F043EE9EB8B5FE7053E61CAAF025971C6816BD36A21D74F8AF8925ECEA6D86A276DC912DF7FD5165D3C09D39B919E0FFABB1625B01811459D2632280FD98B49210453C3B1A2806687FA54E801A14D904D65DF80425AE39A43CA56C68BD211D7990E99E4563918244F40000FFFFFFF1E0257321ED1096BF29FB92CB0F25F900455567F31999F295858D9619E840F44513AC072F6F7440296B0EF1247688B5DBEE7A43DA0CC2FD0766B97F6B6428D20D428A01D597DD0B214E96333EF466B0E9CB8ADE38196A2794DD5247F4AABAB77399C5862556E502E1"
  },
  "status": "error",
  "type": "response"
}

=== Test Complete ===
